# Allen Bradley subscription plugin yaml file input config.

## For subscription implementation

Please use the below format to read from Allen Bradley.

```{"1": [{"address": "tag1", "name":"Pressure", "datatype":"int16","group": "D001", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}```

**address:** Tag address which you want to read.<br />
**name:** which you want in the output.<br /> 
**datatype:** which type of data is generated by the provided tag address. <br />
**group:** group name<br />
**db:** db name <br />
**historian:** historian name<br />
**sqlSp:** stored procedure name<br />

**below is the example benthos input for Allen Bradley**
```
input:
  absubscription:
    tcpDevice: 'localhost' # IP address of the PLC
    timeout: 10             # Timeout in seconds for connections and requests. Default to 10
    subscriptions:
       - '{"1": [{"address": "tag1", "name":"Pressure", "datatype":"int16","group": "D001", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}'
       - '{"2": [{"address": "tag2", "name":"Temperature", "datatype":"str","group": "D002", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}'
```

## For set tSubscription,
Please use the below format to subscribe to tSubscriptions.
```
subscriptions:
   - '{"1": [{"address": "tag1", "datatype":"int16","group": "D001", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}'
   - '{"2": [{"address": "tag2", "datatype":"string","group": "D002", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}'
tsubscriptions:
  - '{"1": [{"address":"tag11","datatype":"int16", "name": "PressureNodeName"}, {"address": "tag12", "datatype":"int16","name": "HumidityNodeName"}]}'
  - '{"2": [{"address":"tag13","datatype":"string","name": "TemperatureNodeName"}, {"address": "tag14", "datatype":"int16","name": "Air Qualit Node Name"}]}'
```

**both subscription and tsubscription length must be the same.**

So in tsubsription when the subscription value changes then you will get tsubscription value in the output.  like when tag1 value change tag11 and tag12 will be in output. 

**below is the example benthos input for Allen Bradley Trigger**
```
input:
  abtrigger:
    tcpDevice: 'localhost' # IP address of the PLC
    timeout: 10             # Timeout in seconds for connections and requests. Default to 10
    subscriptions:
       - '{"1": [{"address": "tag1", "datatype":"int16","group": "D001", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}'
       - '{"2": [{"address": "tag2", "datatype":"string","group": "D002", "db": "mssql", "historian": "influx", "sqlSp": "sp_sql_logging"}]}'
    tsubscriptions:
      - '{"1": [{"address":"tag11","datatype":"int16", "name": "PressureNodeName"}, {"address": "tag12", "datatype":"int16","name": "HumidityNodeName"}]}'
      - '{"2": [{"address":"tag13","datatype":"string","name": "TemperatureNodeName"}, {"address": "tag14", "datatype":"int16","name": "Air Qualit Node Name"}]}'
```

**below is the example of output.**

```
{   "Air_Qualit_Node_Name":"57",
	"TemperatureNodeName":"temparaturedata",
	"db":"mssql",
	"group":"D002",
	"historian":"influx",
	"sqlSp":"sp_sql_logging",
	"timestamp_ms":1712243694046,
	"trigger":"tag2",
	"value":"data"
}
```